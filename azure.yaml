name: tdd-azd-az104allinone 
metadata:
  template:  tdd-azd-az104allinone@0.0.1-beta
infra:
  provider: bicep   # (default; you can omit this line)
  path: infra       # relative path to all your .bicep files
  module: main      # the single entry-point .bicep file
  # Note: All runtime parameters are configured in infra/main.parameters.json
  # See README.md "Configuration" section for details on customizing your deployment

hooks:
  postdown:
    shell: pwsh
    interactive: true
    continueOnError: true
    run: |
      Write-Host "Cleaning up subscription-scoped governance deployment..." -ForegroundColor Yellow
      $hubLocation = (Get-Content infra/main.parameters.json | ConvertFrom-Json).parameters.hubLocation.value
      $deploymentName = "governance-$hubLocation"
      Write-Host "Attempting to delete deployment: $deploymentName" -ForegroundColor Cyan
      az deployment sub delete --name $deploymentName 2>$null
      if ($LASTEXITCODE -eq 0) {
        Write-Host "✓ Governance deployment cleaned up successfully" -ForegroundColor Green
      } else {
        Write-Host "ℹ No governance deployment found (this is normal if governance wasn't deployed)" -ForegroundColor Gray
      }
    